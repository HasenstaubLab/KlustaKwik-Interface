KlustaKwik Spike Sorting Pipeline


Step 1: Collect data for analysis.
	
For data acquired using the TDT system, run TDT2dat.m. This function produces a .dat file containing raw data from a 16 channel probe, that can be read by the klustakwik spike detection software. For a 16 channel probe, the .dat file should be in the form: [channel1sample1, channel2sample1, … channel16sample1, channel1sample2….channel16sampleN].

For data acquired using the open-ephys system, run OpenEphys2Dat.m. This will save a .dat file with the same name as the directory containing the .continuous data.
	

Place raw data file (.dat or .kwd) with the appropriate probe (.prb) and parameter (.prm) file. The probe file contains information about the probe necessary to allow klustakwik to interpret the raw data file. The parameter file contains the probe and raw data filenames, as well as spike detection/sorting variables. 


Step 2: Run Klustakwik’s automatic spike detection/clustering script
	In a windows terminal (Start>cmd), navigate (using the cd command) to the folder containing the raw data, probe, and parameter files. 
	Type: klusta filename.prm (replacing ‘filename’ with the name of the .prm file). This will launch the spike detection software. Processing time should be ~20-30 minutes. 


Step 3: Run Klustaviewa
	Open Klustaviewa via the desktop icon. Open the .kwik file generated by the automatic script from Step 2. 
	Wizard>Reinitialize Wizard will initialize a wizard that will guide you through the automatically clustered data, and allow you to refine the results. The goal of this step is to categorize clusters as ‘Noise’, ‘MUA’, and ‘Good’ clusters. 
	See the user manual (https://github.com/klusta-team/klustaviewa/blob/master/docs/manual.md) for a full explanation of the Klustaviewa software.
	Actions: 
	G: Merge clusters
	K: Split clusters (after drawing a polygon to separate them in FeatureView)
	For clusters suggested by the wizard for combining: 
		Space: reject the suggestion, move on the next candidate
		G: merge the candidate and target clusters
		Ctrl + M: designate the candidate as MUA activity, deletes it from consideration
		Ctrl + N: designate the candidate as noise activity, deletes if from consideration
	Once you’ve finished clustering the target (it shouldn’t be clustered with any other candidates): sort that target: 
	Alt + G: good
	Alt + M: mua
	Alt + N: noise

Once all the clusters have been assigned, SAVE!


Step 4: Use Matlab to analyze data
	The cluster files saved in .kwik format can be imported into matlab. Use kwikimport.m to generate frequency/attenuation curves. IMPORTANT NOTE: This code currently assumes that data was collected using a TDT system. For open-ephys data, must write new code that gathers stimulus presentation information. 

